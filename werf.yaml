project: stats-informer
configVersion: 1
---
image: npm_builder
from: node:lts-alpine
git:
  - add: /frontend
    to: /app
    includePaths:
      - package*.json
shell:
  install:
    - cd /app
    - echo Install dependencies...
    - npm install
---
image: front_builder
fromImage: npm_builder
git:
  - add: /frontend
    to: /app
    excludePaths:
      - package*.json
shell:
  install:
    - cd /app
    - echo Build frontend application...
    - npm run build
---
image: frontend
from: nginx:stable-alpine
import:
  - image: front_builder
    add: /app/dist
    to: /usr/share/nginx/html
    before: setup
---
image: go_builder
from: golang:1.18-alpine
git:
  - add: /backend
    to: /app
    includePaths:
      - go.mod
      - go.sum
shell:
  install:
    - cd /app
    - echo Install dependencies...
    - go mod download
---
image: backend_builder
fromImage: go_builder
git:
  - add: /backend
    to: /app
    excludePaths:
      - go.mod
      - go.sum
shell:
  install:
    - cd /app
    - echo Build backend...
    - go build -o /stats app/main.go
---
image: backend
from: alpine:latest
import:
  - image: backend_builder
    add: /stats
    to: /stats
    before: setup
docker:
  CMD: ["/stats"]