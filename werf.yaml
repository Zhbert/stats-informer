project: stats-informer
configVersion: 1
---
image: frontend_builder
from: node:lts-alpine
git:
  - add: /frontend
    to: /app
    excludePaths:
      - .dockerignore
      - .gitignore
      - Dockerfile
      - README.md
shell:
  install:
    - cd /app
    - echo Install dependencies...
    - npm install
  setup:
    - cd /app
    - echo Build frontend application...
    - npm run build
---
image: frontend
from: nginx:stable-alpine
import:
  - image: frontend_builder
    add: /app/dist
    to: /usr/share/nginx/html
    before: setup
---
image: backend_builder
from: golang:1.18-alpine
git:
  - add: /backend
    to: /app
    excludePaths:
      - Dockerfile
shell:
  install:
    - cd /app
    - echo Install dependencies...
    - go mod download
  setup:
    - cd /app
    - echo Build backend...
    - go build -o /stats app/main.go
---
image: backend
from: alpine:latest
import:
  - image: backend_builder
    add: /stats
    to: /stats
    before: setup
docker:
  CMD: ["/stats"]